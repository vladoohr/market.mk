<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div class="paddingTop">
<%= render 'shared/title', title: 'Внесете нов оглас' %>
<%= render 'shared/errors', obj: @advertisements %>

	<div class="row">
			<div class="col-md-6 col-md-offset-3">
				<%= form_for @advertisement do |f| %>
					
					<%= f.label :type, "Тип* " %>
					<div class="radio-buttons">
						<label>
							Се продава
							<%= f.radio_button(:advert_type, "Се продава") %>
						</label>

						<label>
							Се купува
							<%= f.radio_button(:advert_type, "Се купува") %>
						</label>

						<label>
							Може замена
							<%= f.radio_button(:advert_type, "Може замена") %>
						</label>
					</div>

					<%= f.label :state, "Состојба" %>
					<div class="radio-buttons">
						<label>
							Половен
							<%= f.radio_button(:state, "Половен") %>
						</label>

						<label>
							Нов
							<%= f.radio_button(:state, "Нов") %>
						</label>
					</div>

					<%= f.label :title, "Наслов*"%>
					<%= f.text_field :title, label: "Наслов" %>

					<%= f.label :description, "Опис*"%>
					<%= f.text_area :description %>

					<%= f.label :price, "Цена во денари"%>
					<%= f.number_field :price %>

					<%= f.hidden_field :latitude %>
					<%= f.hidden_field :longitude %>


					<label>Одбери категорија*</label>
					<select id="advertisement_category_id" name="advertisement[category_id]" class="form-control">
			    	<option>Сите категории</option>
			    	<% @categories.to_a.reverse.to_h.each do |k, v| %>
			    		<% if v.values.first == nil %>
			    			<option value="<%= v.keys.first %>"><%= k %></option>
			    		<% else %>
			    			<option value="<%= v.keys.first %>" style="background: #bababa"><%= k %></option>
			    		<% end %>
			    	<% end %>
			    </select>

			    <label>Одбери град*</label>
		    	<% cities_array = City.all.map { |city| [city.name, city.id] } %>
		    	<%= f.select(:city_id, options_for_select(cities_array, ["Цела Македонија", 33]), {},{class: "form-control"}) %>

			    <div>
			    	<label>Означи ја локацијата на производот <small>(Лев клик за додавање маркер, десен за бришење на маркерот.)</small></label>
	  				<div id="map" class="map"></div>
					</div>

					<%= f.submit "Внеси", class: "btn btn-primary"%>
				<% end %>
			</div>
	</div>
</div>
<script>
	var marker;
	handler = Gmaps.build('Google');

	// add listener for setting marker on click
	handler.buildMap({
		provider: {	}, internal: {id: 'map'}}, function(){
			google.maps.event.addListener(handler.getMap(), 'click', function(event) {
				marker = placeMarker(event.latLng);
				document.getElementById("advertisement_latitude").value = event.latLng.lat();
				document.getElementById("advertisement_longitude").value = event.latLng.lng();

				// add listener for removing marker on right click
				google.maps.event.addListener(marker, "rightclick", function (point) { 
					marker.setMap(null);
					document.getElementById("advertisement_latitude").innerHTML = "";
					document.getElementById("advertisement_longitude").innerHTML = "";
				});
		});
	
		handler.map.centerOn({ lat: 41.6, lng: 21.7 })
	  handler.getMap().setZoom(8);
	  handler.fitMapToBounds();
	});

	function placeMarker(location) {
	  var marker = new google.maps.Marker({
	    position: location,
	    map: handler.getMap(),
	  });

	  var infowindow = new google.maps.InfoWindow({
	    content: 'Тука се наоѓа производот'
	  });
	  infowindow.open(handler.getMap(),marker);
	  return marker;
}
</script>